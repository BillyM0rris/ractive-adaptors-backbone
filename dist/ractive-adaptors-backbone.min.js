(function(e,n){typeof exports==="object"&&typeof module!=="undefined"?module.exports=n():typeof define==="function"&&define.amd?define(n):e.Ractive.adaptors.Backbone=n()})(this,function(){"use strict";var e=undefined;var n="_ractiveAdaptorsBackboneLock";function t(e){e[n]=(e[n]||0)+1;return function t(){e[n]-=1;if(!e[n]){delete e[n]}}}function o(e){return!!e[n]}var i={init:function u(n){e=n},filter:function c(n){if(!e){throw new Error("Could not find Backbone. You must call adaptor.init(Backbone) - see http://TKTKTK.com for more information")}return n instanceof e.Model||n instanceof e.Collection},wrap:function s(n,t,o,i){if(t instanceof e.Model){return new r(n,t,o,i)}return new a(n,t,o,i)}};if(typeof window!=="undefined"&&window.Backbone){e=window.Backbone}function r(e,n,o,i){this.value=n;n.on("change",this.modelChangeHandler=function(){var o=t(n);e.set(i(n.changed));o()})}r.prototype={teardown:function d(){this.value.off("change",this.modelChangeHandler)},get:function l(){return this.value.toJSON()},set:function h(e,n){if(!o(this.value)&&e.indexOf(".")===-1){this.value.set(e,n)}},reset:function v(n){if(n instanceof e.Model||!(n instanceof Object)){return false}this.value.set(n)}};function a(e,n,o){this.value=n;n.on("add remove reset sort",this.changeHandler=function(){var i=t(n);e.set(o,n.models);i()})}a.prototype={teardown:function p(){this.value.off("add remove reset sort",this.changeHandler)},get:function m(){return this.value.models},reset:function w(n){if(o(this.value)){return}if(n instanceof e.Collection||Object.prototype.toString.call(n)!=="[object Array]"){return false}this.value.reset(n)}};var f=i;return f});